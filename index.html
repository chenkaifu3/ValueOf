<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ValueOf - 物品价值管理</title>
  <meta name="description" content="记录个人购买物品的总价值，计算日均分摊成本">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body>
  <div id="app">
    <!-- 首页 - 物品列表 -->
    <div id="page-items" class="page active">
      <!-- 顶部统计卡片 -->
      <div class="summary-card glass-card">
        <div class="summary-header">
          <div class="item-count">
            <span class="count" id="total-count">0</span>
            <span>件物品</span>
          </div>
          <button class="category-filter" id="category-filter-btn">
            <span id="current-category-name">全部分类</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
        </div>
        <div class="summary-stats">
          <div class="stat-item">
            <div class="stat-label">总资产</div>
            <div class="stat-value" id="total-value">¥0</div>
          </div>
          <div class="stat-item" id="total-daily-card">
            <div class="stat-label">总日均成本</div>
            <div class="stat-value small" id="total-daily">¥0/天</div>
          </div>
        </div>
      </div>

      <!-- 分类标签 -->
      <div class="filter-row">
        <div class="category-tabs" id="category-tabs">
          <button class="category-tab active" data-category="all">全部</button>
          <button class="category-tab" data-category="digital">数码产品</button>
          <button class="category-tab" data-category="life">生活运动</button>
          <button class="category-tab" data-category="clothes">衣物鞋包</button>
          <button class="category-tab" data-category="beauty">护肤美妆</button>
          <button class="category-tab" data-category="furniture">家具电器</button>
          <button class="category-tab" data-category="other">其他</button>
        </div>
        <button class="sort-btn" id="sort-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M6 12h12M9 18h6" />
          </svg>
        </button>
      </div>

      <!-- 排序菜单 -->
      <div class="sort-menu" id="sort-menu">
        <div class="sort-menu-section">
          <div class="sort-menu-title">排序字段</div>
          <div class="sort-option" data-sort-field="daily">日均成本</div>
          <div class="sort-option" data-sort-field="perUse">次均成本</div>
          <div class="sort-option" data-sort-field="price">价格</div>
          <div class="sort-option" data-sort-field="purchaseDate">购买时间</div>
        </div>
        <div class="sort-menu-divider"></div>
        <div class="sort-menu-section">
          <div class="sort-menu-title">排序方向</div>
          <div class="sort-option" data-sort-order="desc">从高到低 / 最新</div>
          <div class="sort-option" data-sort-order="asc">从低到高 / 最早</div>
        </div>
      </div>

      <!-- 物品列表 -->
      <div class="items-list" id="items-list">
        <!-- 动态生成 -->
      </div>

      <!-- 空状态 -->
      <div class="empty-state" id="empty-state" style="display: none;">
        <div class="empty-icon">📦</div>
        <div class="empty-title">还没有物品</div>
        <div class="empty-text">点击下方 + 按钮添加你的第一件物品</div>
      </div>
    </div>

    <!-- 添加/编辑物品页面 -->
    <div id="page-add" class="page">
      <div class="page-header">
        <button class="back-btn" id="back-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          返回
        </button>
        <h1 class="page-title" id="add-page-title">添加物品</h1>
        <div></div>
      </div>

      <div class="form-container">
        <form id="item-form">
          <div class="form-group">
            <label class="form-label">名称 <span class="required">*</span></label>
            <input type="text" class="form-input" id="item-name" placeholder="输入物品名称" required>
          </div>

          <div class="form-group">
            <label class="form-label">分类 <span class="required">*</span></label>
            <select class="form-input" id="item-category" required>
              <option value="">选择分类</option>
              <option value="digital">数码产品</option>
              <option value="life">生活运动</option>
              <option value="clothes">衣物鞋包</option>
              <option value="beauty">护肤美妆</option>
              <option value="furniture">家具电器</option>
              <option value="other">其他</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">图标/照片</label>
            <div class="icon-picker-wrapper">
              <div class="icon-picker-toggle" id="icon-picker-toggle">
                <span class="current-icon" id="current-icon">📱</span>
                <span class="toggle-text">点击选择图标</span>
                <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="icon-picker" id="icon-picker">
                <!-- 图标将由 JS 动态生成 -->
              </div>
            </div>
            <div class="photo-upload-area" id="photo-upload-area">
              <input type="file" id="item-photo" accept="image/*" style="display: none;">
              <div class="photo-preview" id="photo-preview" style="display: none;">
                <img id="photo-preview-img" src="" alt="预览">
                <button type="button" class="photo-remove" id="photo-remove">✕</button>
              </div>
              <button type="button" class="photo-upload-btn" id="photo-upload-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                  <circle cx="8.5" cy="8.5" r="1.5" />
                  <polyline points="21 15 16 10 5 21" />
                </svg>
                <span>从相册选择照片</span>
              </button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">购买价格 <span class="required">*</span></label>
            <input type="number" class="form-input" id="item-price" placeholder="输入购买价格" step="0.01" min="0" required>
          </div>

          <div class="form-group">
            <label class="form-label">购买日期 <span class="required">*</span></label>
            <input type="date" class="form-input" id="item-purchase-date" required>
          </div>

          <div class="form-group">
            <label class="form-label">退役日期（选填）</label>
            <input type="date" class="form-input" id="item-retire-date">
          </div>

          <div class="form-group">
            <label class="form-label">计算均价方式</label>
            <select class="form-input" id="item-calc-method">
              <option value="time">按时间（天）</option>
              <option value="count">按次数</option>
              <option value="none">不计算</option>
            </select>
          </div>

          <div class="form-group" id="usage-count-group" style="display: none;">
            <label class="form-label">使用次数</label>
            <input type="number" class="form-input" id="item-usage-count" placeholder="输入使用次数" min="1" value="1">
          </div>

          <div class="form-group">
            <label class="form-label">备注</label>
            <textarea class="form-input" id="item-note" placeholder="添加备注信息"></textarea>
          </div>
        </form>
      </div>

      <div class="save-btn-fixed">
        <button class="save-btn" id="save-btn">保存物品</button>
      </div>
    </div>

    <!-- 我的页面 -->
    <div id="page-profile" class="page">
      <div class="page-header">
        <div></div>
        <h1 class="page-title">我的</h1>
        <div></div>
      </div>

      <div class="profile-section">
        <div class="profile-section-title">数据管理</div>
        <div class="profile-card glass-card">
          <div class="profile-item" id="sync-btn">
            <div class="profile-item-left">
              <div class="profile-item-icon">☁️</div>
              <div class="profile-item-text">云端同步</div>
            </div>
            <div class="sync-status not-synced" id="sync-status">
              <span>未配置</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
          <div class="profile-item" id="icon-manage-btn">
            <div class="profile-item-left">
              <div class="profile-item-icon">🎨</div>
              <div class="profile-item-text">图标管理</div>
            </div>
            <div class="profile-item-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
          <div class="profile-item" id="default-template-btn">
            <div class="profile-item-left">
              <div class="profile-item-icon">📝</div>
              <div class="profile-item-text">默认模板设置</div>
            </div>
            <div class="profile-item-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
          <div class="profile-item" id="export-btn">
            <div class="profile-item-left">
              <div class="profile-item-icon">📤</div>
              <div class="profile-item-text">导出数据</div>
            </div>
            <div class="profile-item-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
          <div class="profile-item" id="screenshot-btn">
            <div class="profile-item-left">
              <div class="profile-item-icon">📸</div>
              <div class="profile-item-text">导出长截图</div>
            </div>
            <div class="profile-item-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
          <div class="profile-item" id="import-btn">
            <div class="profile-item-left">
              <div class="profile-item-icon">📥</div>
              <div class="profile-item-text">导入数据</div>
            </div>
            <div class="profile-item-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="profile-section">
        <div class="profile-section-title">关于</div>
        <div class="profile-card glass-card">
          <div class="profile-item">
            <div class="profile-item-left">
              <div class="profile-item-icon">ℹ️</div>
              <div class="profile-item-text">版本</div>
            </div>
            <div class="sync-status not-synced">
              <span>1.0.0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 底部导航 -->
    <nav class="bottom-nav">
      <button class="nav-item active" data-page="items">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
        </svg>
        <span>物品</span>
      </button>
      <button class="nav-add" id="nav-add">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
      <button class="nav-item" data-page="profile">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span>我的</span>
      </button>
    </nav>
  </div>

  <!-- 同步配置弹窗 - GitHub Gist -->
  <div class="modal-overlay" id="sync-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">GitHub Gist 云端同步</h3>
      </div>
      <div class="modal-body">
        <p class="sync-hint">使用 GitHub Gist 免费同步数据。<a
            href="https://github.com/settings/tokens/new?scopes=gist&description=ValueOf%20Sync" target="_blank">点击获取
            Token</a></p>
        <div class="form-group">
          <label class="form-label">GitHub Token <span class="required">*</span></label>
          <input type="password" class="form-input" id="sync-token" placeholder="ghp_xxxxxxxxxxxx">
        </div>
        <div class="form-group">
          <label class="form-label">Gist ID（留空自动创建）</label>
          <input type="text" class="form-input" id="sync-gist-id" placeholder="自动创建新 Gist">
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" id="sync-cancel">取消</button>
        <button class="modal-btn" id="sync-download">拉取云端</button>
        <button class="modal-btn confirm" id="sync-save">上传同步</button>
      </div>
    </div>
  </div>

  <!-- 删除确认弹窗 -->
  <div class="modal-overlay" id="delete-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">确认删除</h3>
      </div>
      <div class="modal-body">
        <p>确定要删除这件物品吗？此操作无法撤销。</p>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" id="delete-cancel">取消</button>
        <button class="modal-btn danger" id="delete-confirm">删除</button>
      </div>
    </div>
  </div>

  <!-- 图标管理弹窗 -->
  <div class="modal-overlay" id="icon-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">图标管理</h3>
      </div>
      <div class="modal-body">
        <p class="sync-hint">添加自定义图标（支持 emoji 或单个字符）</p>
        <div class="form-group">
          <label class="form-label">添加新图标</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" class="form-input" id="new-icon-input" placeholder="输入 emoji 或字符" maxlength="2"
              style="flex: 1;">
            <button class="save-btn" id="add-icon-btn" style="padding: 12px 16px;">添加</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">当前图标库</label>
          <div class="icon-picker expanded" id="icon-manage-picker" style="display: flex;"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" id="icon-modal-close">关闭</button>
        <button class="modal-btn" id="reset-icons-btn">恢复默认</button>
      </div>
    </div>
  </div>

  <!-- 默认模板设置弹窗 -->
  <div class="modal-overlay" id="template-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">默认模板设置</h3>
      </div>
      <div class="modal-body">
        <p class="sync-hint">设置添加新物品时的默认值</p>
        <div class="form-group">
          <label class="form-label">默认分类</label>
          <select class="form-input" id="tpl-category">
            <option value="digital">数码产品</option>
            <option value="life">生活运动</option>
            <option value="clothes">衣物鞋包</option>
            <option value="beauty">护肤美妆</option>
            <option value="furniture">家具电器</option>
            <option value="other">其他</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">默认图标</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="text" class="form-input" id="tpl-icon" placeholder="输入默认 Emoji，如 👗" maxlength="2"
              style="flex:1;">
            <div id="tpl-icon-preview"
              style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 20px;">
              ?</div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">默认计费方式</label>
          <select class="form-input" id="tpl-method">
            <option value="time">按天计算</option>
            <option value="count">按次数计算</option>
            <option value="none">不计算</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" id="tpl-cancel">取消</button>
        <button class="modal-btn confirm" id="tpl-save">保存</button>
      </div>
    </div>
  </div>

  <!-- Toast 提示 -->
  <div class="toast" id="toast"></div>

  <!-- 隐藏的文件输入 -->
  <input type="file" id="import-file" accept=".json" style="display: none;">

  <script src="app.js"></script>
</body>

</html>